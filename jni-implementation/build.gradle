import static org.gradle.internal.os.OperatingSystem.current

plugins {
  id 'cpp-library'
}

def javaHome = System.getenv("JAVA8_HOME")

library {
  binaries.configureEach {
    if (current().isWindows()) { {
      compileTask.get().compilerArgs.add('/std:c++latest')
      }
    } else {
        compileTask.get().compilerArgs.add('-std=c++20')
    }
  }
  source.from 'src/main/cpp', '../jni-bindings/build/generated/sources/headers/java/main'
  privateHeaders.from '../jni-bindings/build/generated/sources/headers/java/main',
    'src/external/llama.cpp', "$javaHome/include", "$javaHome/include/linux",
    "$javaHome/include/win32", "$javaHome/include/darwin"
}

tasks.withType(CppCompile) {
  dependsOn ':jni-bindings:compileJava'
}